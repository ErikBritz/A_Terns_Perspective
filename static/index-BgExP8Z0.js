(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function e(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(t){if(t.ep)return;t.ep=!0;const r=e(t);fetch(t.href,r)}})();Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJkZTFkZWI0NS05Yzk0LTQwZmEtYWQ2NC0zMzA4MmYxNzJjYjAiLCJpZCI6MzUyNzQyLCJpYXQiOjE3NjEwNzEzMTF9.BE9PLgfA-0BEP3cJp0Rp4uvhXUvxBRO4F18s6lpfAj0";const V=new Cesium.Cartesian3(-12e6,0,2e6),s=new Cesium.Viewer("cesiumContainer",{terrain:Cesium.Terrain.fromWorldTerrain({requestVertexNormals:!0,requestWaterMask:!0}),shouldAnimate:!1,animation:!1,timeline:!1,baseLayerPicker:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,fullscreenButton:!1,infoBox:!1,selectionIndicator:!1,vrButton:!1});s.scene.globe.preloadAncestors=!0;s.scene.globe.preloadSiblings=!0;s.scene.globe.maximumScreenSpaceError=1;s.scene.globe.enableLighting=!1;s.scene.light=new Cesium.DirectionalLight({direction:new Cesium.Cartesian3(.2,-.6,-.8),color:Cesium.Color.WHITE,intensity:2});const E=s.imageryLayers.get(0);E&&(E.brightness=1.35,E.contrast=1.1,E.saturation=1.12);const D=document.getElementById("birdSpeed"),L=document.getElementById("birdSpeedValue"),I=document.getElementById("hudDate"),N=document.getElementById("hudDistance"),M=document.getElementById("loadingOverlay");let p=1,u=null,A=null,T=null,n=null,h=[],S=[],g=-1;function Y(i){if(!i)return"";const a=new Date(`${i}T00:00:00Z`);return Number.isNaN(a.getTime())?"":new Intl.DateTimeFormat("en-US",{month:"short",year:"numeric",timeZone:"UTC"}).format(a)}function H(i,a){let e=0,l=i.length-1;for(;e<=l;){const t=Math.floor((e+l)/2),r=i[t].time_period;if(r===a)return t;r<a?e=t+1:l=t-1}return Math.max(0,Math.min(i.length-1,e))}function K(i){try{const a=document.getElementById("insetCesium");if(!a)return;n=new Cesium.Viewer(a,{animation:!1,timeline:!1,baseLayerPicker:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,fullscreenButton:!1,infoBox:!1,selectionIndicator:!1,vrButton:!1,shouldAnimate:!1,contextOptions:{webgl:{alpha:!0}}}),n.imageryLayers.removeAll(),n.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",minimumLevel:0,maximumLevel:6})),n.scene.globe.show=!0,n.scene.backgroundColor=Cesium.Color.TRANSPARENT,a.style.background="transparent",n.scene.skyBox.show=!1,n.scene.skyAtmosphere.show=!1,n.scene.globe.baseColor=Cesium.Color.TRANSPARENT,n.scene.globe.showGroundAtmosphere=!1,n.scene.globe.enableLighting=!1,n.scene.fog.enabled=!1,n.scene.sun.show=!1,n.scene.moon.show=!1,n.scene.screenSpaceCameraController.enableRotate=!1,n.scene.screenSpaceCameraController.enableTranslate=!1,n.scene.screenSpaceCameraController.enableZoom=!1,n.scene.screenSpaceCameraController.enableTilt=!1,n.scene.screenSpaceCameraController.enableLook=!1,h=i.map(e=>Cesium.Cartesian3.fromDegrees(e.lon,e.lat,0)),g=0,S=[h[0]],n.entities.add({polyline:{positions:new Cesium.CallbackProperty(()=>S,!1),width:2,material:Cesium.Color.CYAN.withAlpha(.9)}}),n.entities.add({position:new Cesium.CallbackProperty(()=>h[g],!1),point:{pixelSize:5,color:Cesium.Color.CYAN,outlineColor:Cesium.Color.BLACK,outlineWidth:1}}),n.camera.setView({destination:Cesium.Cartesian3.fromDegrees(0,0,25e6),orientation:{heading:0,pitch:Cesium.Math.toRadians(-90),roll:0}}),setTimeout(()=>{n.resize()},0)}catch(a){console.error("Inset map failed to initialize",a),n=null}}function j(i){if(!n||i===g)return;g=Math.min(i,h.length-1),S=h.slice(0,g+1);const a=h[g];a&&n.camera.lookAt(a,new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90),22e6))}D&&(D.value=p.toFixed(2),L&&(L.textContent=`${p.toFixed(2)}×`),D.addEventListener("input",()=>{p=Number(D.value),L&&(L.textContent=`${p.toFixed(2)}×`),s.clock.multiplier=p}));async function U(){var B;const e=(await(await fetch("arte_great_circle_path_3D.json")).json()).sort((o,m)=>o.time_period-m.time_period);K(e),M&&setTimeout(()=>{M.classList.add("hidden"),setTimeout(()=>{M.remove()},700)},3e3);const l=40,t=((B=e[0])==null?void 0:B.time_period)??0,r=1500,c=Cesium.JulianDate.fromDate(new Date),d=(e[e.length-1].time_period-t)*l,v=Cesium.JulianDate.addSeconds(c,d,new Cesium.JulianDate),k=Cesium.Cartesian3.fromDegrees(e[0].lon,e[0].lat,e[0].Elevation||3e4);let y=0;for(let o=1;o<e.length;o+=1){const m=Cesium.Cartesian3.fromDegrees(e[o].lon,e[o].lat,e[o].Elevation||3e4);if(Cesium.Cartesian3.distance(k,m)>r){y=(e[o].time_period-t)*l;break}}s.clock.startTime=c.clone(),s.clock.stopTime=v.clone(),s.clock.currentTime=c.clone(),s.clock.clockRange=Cesium.ClockRange.CLAMPED,u={sortedData:e,start:c,timeMultiplier:l,baseTimePeriod:t,cumulativeKm:[]};const w=[0];for(let o=1;o<e.length;o+=1){const m=e[o-1],P=e[o],O=Cesium.Cartesian3.fromDegrees(m.lon,m.lat,0),J=Cesium.Cartesian3.fromDegrees(P.lon,P.lat,0),F=Cesium.Ellipsoid.WGS84.cartesianToCartographic(O),z=Cesium.Ellipsoid.WGS84.cartesianToCartographic(J),_=new Cesium.EllipsoidGeodesic(F,z).surfaceDistance/1e3;w.push(w[o-1]+_)}u.cumulativeKm=w;const f=new Cesium.SampledPositionProperty;e.forEach(o=>{const m=Cesium.JulianDate.addSeconds(c,(o.time_period-t)*l,new Cesium.JulianDate),P=Cesium.Cartesian3.fromDegrees(o.lon,o.lat,o.Elevation||3e4);f.addSample(m,P)}),f.setInterpolationOptions({interpolationAlgorithm:Cesium.HermitePolynomialApproximation,interpolationDegree:5});const b=s.entities.add({position:f,orientation:new Cesium.VelocityOrientationProperty(f),viewFrom:V,model:{uri:"arctic_tern_model.glb",minimumPixelSize:120,runAnimations:!0},path:{resolution:1,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.1,color:Cesium.Color.CYAN}),width:4}}),C=e[0];s.camera.setView({destination:Cesium.Cartesian3.fromDegrees(C.lon,C.lat,25e6),orientation:{heading:Cesium.Math.toRadians(0),pitch:Cesium.Math.toRadians(-92),roll:0}});const x=()=>{setTimeout(()=>{const o=Cesium.Cartesian3.fromDegrees(C.lon-60,C.lat+20,35e6),m=Cesium.Cartesian3.fromDegrees(C.lon,C.lat,12e5);s.camera.flyTo({destination:m,duration:6,easingFunction:Cesium.EasingFunction.CUBIC_OUT,orientation:{heading:Cesium.Math.toRadians(15),pitch:Cesium.Math.toRadians(-85),roll:0},start:o,complete:()=>{s.clock.currentTime=Cesium.JulianDate.addSeconds(c,y,new Cesium.JulianDate),s.clock.shouldAnimate=!0,s.clock.multiplier=p,s.trackedEntity=b,A=b,s.zoomTo(b)}})},1e3)},R=s.scene.globe.tileLoadProgressEvent.addEventListener(o=>{o===0&&(x(),R())});setTimeout(()=>{s.clock.shouldAnimate||x()},7e3)}window.addEventListener("error",i=>{console.error(i.error||i.message)});window.addEventListener("unhandledrejection",i=>{console.error(i.reason)});U().catch(i=>{console.error(i)});s.clock.onTick.addEventListener(i=>{var r,c;if(A){const d=A.position.getValue(i.currentTime),v=(r=A.orientation)==null?void 0:r.getValue(i.currentTime);if(d&&v){const y=Cesium.HeadingPitchRoll.fromQuaternion(v).heading+Math.PI;if(T===null)T=y;else{const b=Cesium.Math.negativePiToPi(y-T);T+=b*.08}const w=Cesium.Math.toRadians(-35),f=55e5;s.camera.lookAt(d,new Cesium.HeadingPitchRange(T,w,f))}}if(!I)return;if(!u){I.textContent="Loading date…";return}const e=Cesium.JulianDate.secondsDifference(i.currentTime,u.start)/u.timeMultiplier+u.baseTimePeriod,l=H(u.sortedData,e),t=Y((c=u.sortedData[l])==null?void 0:c.date);if(I.textContent=t||"",N&&u.cumulativeKm.length){const d=u.cumulativeKm[l]||0;N.textContent=`${d.toFixed(0)} km`}j(l)});
